# Detailed Methods and Implementations

## Overview

This chapter derives pricing formulas from a unified perspective of risk and interest rates. Through measure transformation, we map market risk into martingale processes under the risk-neutral world, thereby deriving pricing PDEs. Under this framework, derivative prices are viewed as value functions satisfying specific PDEs (or expectation equations), while different models (e.g., Black-Scholes, Heston) merely correspond to different dynamical assumptions and measure structures.

---

## üß© I. Core Idea: Deriving Price from Risk

In derivative pricing, the existence of risk necessitates introducing a probability measure to define "fair price."
The measurement of risk, together with the interest rate (r), jointly determines the discounted future expected value.

In other words:

**"Price = Discounted Expectation under Some Measure"**

That is:
```
V‚Çú = e^(-r(T-t)) E^Q[Payoff | ‚Ñ±‚Çú]
```

---

## ‚öôÔ∏è II. Logical Chain

| Level | Mathematical Object | Intuition | Corresponding Model |
|-------|---------------------|-----------|---------------------|
| **Stochastic Process** | dS = ŒºSdt + œÉSdW | Randomness of market prices | GBM (Black-Scholes assumption) |
| **Measure Change** | From physical measure P to risk-neutral measure Q | Eliminate risk premium | Girsanov Theorem |
| **Value Function** | V(S,t) = E^Q[e^(-r(T-t))Œ†(S‚Çú)] | Define derivative price | Risk-neutral pricing formula |
| **PDE / ODE** | ‚àÇ‚ÇúV + ‚ÑíV - rV = 0 | Dynamic evolution | Black-Scholes PDE |
| **Boundary Conditions** | Payoff terminal condition | Value at expiry | European, Asian, American, etc. |
| **Numerical Methods** | FDM / MC / Fourier | Compute actual prices | Implementation & stability |

---

## üßÆ III. Why Do We Need a "New Measure"?

Under the original measure P, future returns contain a risk premium, making the value function unsuitable for directly computing "arbitrage-free prices."
We therefore introduce the **risk-neutral measure Q**, under which the discounted asset price becomes a **martingale**:

```
e^(-rt)S‚Çú is a martingale under Q
```

This is the junction of "measurability + pricability":

- **Measurability** comes from the probability space (Œ©, ‚Ñ±, Q)
- **Pricability** comes from the martingale property (i.e., no-arbitrage condition)

---

## 1. Black-Scholes Model: The Simplest Measure Change

### From Physical Measure to Risk-Neutral Measure

**Price dynamics under physical measure P**:
```
dS = ŒºSdt + œÉSdW^P
```
where Œº is the actual drift rate (includes risk premium)

**Price dynamics under risk-neutral measure Q**:
Through the Girsanov theorem, perform a measure change by setting:
```
W^Q = W^P + ((Œº-r)/œÉ)t
```

Then under Q:
```
dS = rSdt + œÉSdW^Q
```

**Key Insight**: The risk premium (Œº-r) is "absorbed" into the measure change; under the new measure, the price drifts only at the risk-free rate r.

### PDE Derivation of the Value Function

**Option value definition** (under Q):
```
V(S,t) = e^(-r(T-t)) E^Q[Payoff(S‚Çú) | ‚Ñ±‚Çú]
```

**Applying It√¥'s Lemma**:
Apply It√¥'s lemma to e^(-rt)V(S,t). Since it is a martingale under Q, its drift term must be zero:
```
‚àÇV/‚àÇt + (1/2)œÉ¬≤S¬≤‚àÇ¬≤V/‚àÇS¬≤ + rS‚àÇV/‚àÇS - rV = 0
```

This is the famous **Black-Scholes PDE**.

### Analytical Solution: European Options

**Terminal condition** (boundary condition):
```
Call: V(S,T) = max(S-K, 0)
Put:  V(S,T) = max(K-S, 0)
```

**Analytical solutions**:

*European Call Option*:
```
C = S‚ÇÄe^(-qT)Œ¶(d‚ÇÅ) - Ke^(-rT)Œ¶(d‚ÇÇ)
```

*European Put Option*:
```
P = Ke^(-rT)Œ¶(-d‚ÇÇ) - S‚ÇÄe^(-qT)Œ¶(-d‚ÇÅ)
```

Where:
```
d‚ÇÅ = [ln(S‚ÇÄ/K) + (r - q + œÉ¬≤/2)T] / (œÉ‚àöT)
d‚ÇÇ = d‚ÇÅ - œÉ‚àöT
Œ¶(x) = standard normal cumulative distribution function
```

**Probabilistic Interpretation**:
- Œ¶(d‚ÇÅ) = "adjusted probability" that the underlying price exceeds the strike under Q
- Œ¶(d‚ÇÇ) = probability that the option finishes in-the-money under Q
- e^(-rT) = discount factor

### Greeks: Partial Derivatives of the Value Function

Greeks are sensitivities of the value function to various parameters, essentially partial derivatives of the PDE solution:

**Delta (Œî)** - First derivative w.r.t. underlying price:
```
Call: Œî = e^(-qT)Œ¶(d‚ÇÅ)
Put:  Œî = e^(-qT)[Œ¶(d‚ÇÅ) - 1]
```
Interpretation: Hedge ratio; holding Œî units of the underlying hedges the instantaneous price risk of the option.

**Gamma (Œì)** - Second derivative w.r.t. underlying price:
```
Œì = e^(-qT)œÜ(d‚ÇÅ)/(S‚ÇÄœÉ‚àöT)
```
Interpretation: Rate of change of Delta; measures "convexity risk" of the hedged portfolio.

**Vega (ŒΩ)** - Derivative w.r.t. volatility:
```
ŒΩ = S‚ÇÄe^(-qT)œÜ(d‚ÇÅ)‚àöT
```
Interpretation: Volatility risk exposure.

**Theta (Œò)** - Time decay:
```
Call: Œò = -S‚ÇÄe^(-qT)œÜ(d‚ÇÅ)œÉ/(2‚àöT) - rKe^(-rT)Œ¶(d‚ÇÇ) + qS‚ÇÄe^(-qT)Œ¶(d‚ÇÅ)
Put:  Œò = -S‚ÇÄe^(-qT)œÜ(d‚ÇÅ)œÉ/(2‚àöT) + rKe^(-rT)Œ¶(-d‚ÇÇ) - qS‚ÇÄe^(-qT)Œ¶(-d‚ÇÅ)
```
Interpretation: Rate of time value decay.

**Rho (œÅ)** - Derivative w.r.t. risk-free rate:
```
Call: œÅ = KTe^(-rT)Œ¶(d‚ÇÇ)
Put:  œÅ = -KTe^(-rT)Œ¶(-d‚ÇÇ)
```
Interpretation: Interest rate risk exposure.

### Implementation Considerations

**Numerical Stability**:
- Extreme moneyness cases: S/K ‚Üí 0 or S/K ‚Üí ‚àû
- Asymptotic expansions for very short or very long time to expiry
- Robust normal CDF/PDF calculations

**Implied Volatility Calculation**:
Newton-Raphson iteration:
```
œÉ‚Çô‚Çä‚ÇÅ = œÉ‚Çô - [BS_Price(œÉ‚Çô) - Market_Price] / Vega(œÉ‚Çô)
```

**Extensions**:
- American options via binomial trees or finite difference methods
- Discrete dividend adjustments
- Currency options with foreign interest rate

---

## 2. Heston Model: Stochastic Volatility and Measure Change

### Why Stochastic Volatility?

Black-Scholes assumes constant volatility, but markets exhibit:
- **Volatility smile/skew**: Different implied volatilities for different strikes
- **Volatility clustering**: High and low volatility periods cluster
- **Leverage effect**: Volatility rises when stock price falls (negative correlation)

### Two-Factor System

**Under risk-neutral measure Q**:
```
dS(t) = rS(t)dt + ‚àöv(t)S(t)dW‚ÇÅ^Q(t)
dv(t) = Œ∫(Œ∏ - v(t))dt + Œæ‚àöv(t)dW‚ÇÇ^Q(t)
```

Where:
```
dW‚ÇÅ^Q(t)dW‚ÇÇ^Q(t) = œÅdt
```

**Parameter Interpretation** (from risk perspective):
- **v(t)**: Instantaneous variance (time-varying risk measure)
- **Œ∫**: Mean reversion speed of variance (speed of risk "self-correction")
- **Œ∏**: Long-run variance level (long-term average risk)
- **Œæ**: Volatility of volatility ("risk of risk")
- **œÅ**: Correlation between price and volatility (leverage effect, typically œÅ < 0)

**Feller Condition**:
```
2Œ∫Œ∏ > Œæ¬≤
```
Ensures the variance process v(t) stays strictly positive (risk cannot be negative).

### Understanding Pricing from a Measure Perspective

**Value function** (under Q):
```
V(S,v,t) = e^(-r(T-t)) E^Q[Payoff(S‚Çú) | S‚Çú=S, v‚Çú=v]
```

**Corresponding PDE** (2D Feynman-Kac):
```
‚àÇV/‚àÇt + (1/2)vS¬≤‚àÇ¬≤V/‚àÇS¬≤ + œÅŒævS‚àÇ¬≤V/(‚àÇS‚àÇv) + (1/2)Œæ¬≤v‚àÇ¬≤V/‚àÇv¬≤
    + rS‚àÇV/‚àÇS + Œ∫(Œ∏-v)‚àÇV/‚àÇv - rV = 0
```

**Interpretation**:
- First line: Diffusion terms (risk terms)
- Second line: Drift terms (under Q, all are r or mean-reverting)
- Last term: Discounting

### Characteristic Function Method

**Heston Characteristic Function**:
```
œÜ(u,T) = exp(C(u,T) + D(u,T)v‚ÇÄ + iu ln(S‚ÇÄ))
```

**Component Functions**:
```
d = ‚àö[(œÅŒæui - Œ∫)¬≤ + Œæ¬≤(ui + u¬≤)]
g = (Œ∫ - œÅŒæui - d)/(Œ∫ - œÅŒæui + d)

C(u,T) = rTui + (Œ∫Œ∏/Œæ¬≤)[(Œ∫ - œÅŒæui - d)T - 2ln((1 - ge^(-dT))/(1 - g))]
D(u,T) = ((Œ∫ - œÅŒæui - d)/Œæ¬≤) √ó ((1 - e^(-dT))/(1 - ge^(-dT)))
```

### Fourier Inversion Pricing

**Call Option Formula**:
```
C = S‚ÇÄe^(-qT)P‚ÇÅ - Ke^(-rT)P‚ÇÇ
```

**Probability Integrals**:
```
P‚±º = (1/2) + (1/œÄ) ‚à´‚ÇÄ^‚àû Re[e^(-iu ln K)œÜ‚±º(u,T)/(iu)] du
```

where œÜ‚ÇÅ and œÜ‚ÇÇ are modified characteristic functions.

**Interpretation**:
- P‚ÇÅ, P‚ÇÇ are analogous to Œ¶(d‚ÇÅ), Œ¶(d‚ÇÇ) in Black-Scholes
- But now obtained via Fourier inversion from characteristic functions
- Still essentially "adjusted probabilities" under Q

### Numerical Implementation

**FFT-Based Pricing**:
1. Discretize integration domain: u ‚àà [0, U] with N points
2. Apply FFT to compute option prices for multiple strikes simultaneously
3. Use damping parameter Œ± to ensure convergence

**Monte Carlo Simulation**:
Euler discretization (Full Truncation scheme):
```
S·µ¢‚Çä‚ÇÅ = S·µ¢ exp((r - q - v·µ¢/2)Œît + ‚àö(v·µ¢Œît)Z‚ÇÅ,·µ¢‚Çä‚ÇÅ)
v·µ¢‚Çä‚ÇÅ = v·µ¢ + Œ∫(Œ∏ - v·µ¢)Œît + Œæ‚àö(max(v·µ¢,0)Œît)Z‚ÇÇ,·µ¢‚Çä‚ÇÅ
```

Correlated random number generation:
```
Z‚ÇÇ = œÅZ‚ÇÅ + ‚àö(1-œÅ¬≤)ZÃÉ‚ÇÇ
```

### Model Calibration

**Objective Function** (minimize relative errors):
```
f(Œò) = Œ£·µ¢ [(V_market^i - V_model^i(Œò))/V_market^i]¬≤
```

**Parameter Constraints** (ensure measure validity):
- v‚ÇÄ > 0: Initial variance is positive
- Œ∫ > 0: Positive mean reversion
- Œ∏ > 0: Long-run variance is positive
- Œæ > 0: Vol-of-vol is positive
- |œÅ| < 1: Correlation bounds
- 2Œ∫Œ∏ > Œæ¬≤: Feller condition

**Optimization Methods**:
- Global optimization: Differential Evolution, Particle Swarm
- Local refinement: L-BFGS-B with parameter bounds
- Multi-start strategy to avoid local optima

---

## 3. Value at Risk (VaR): Understanding Risk Measures from a Measure Perspective

### Mathematical Definition

**Value at Risk** (under measure P):
```
VaR‚Çê(X) = inf{x ‚àà ‚Ñù : P(X ‚â§ x) ‚â• Œ±}
```

**Conditional Value at Risk (Expected Shortfall)**:
```
CVaR‚Çê(X) = E[X | X ‚â§ VaR‚Çê(X)]
```

**Interpretation**:
- VaR: Maximum loss at confidence level (1-Œ±)
- CVaR: Conditional expected loss beyond VaR
- Note: These are measured under the **physical measure P**, not the risk-neutral measure Q

### Calculation Methods

**1. Historical Simulation**:
```
VaR‚ÇÖ% = 5th percentile of historical P&L distribution
```

Steps:
1. Collect historical asset returns: r‚ÇÅ, r‚ÇÇ, ..., r‚Çô
2. Apply current portfolio weights: P&L·µ¢ = w·µÄr·µ¢
3. Sort P&L values: P&L‚Çç‚ÇÅ‚Çé ‚â§ P&L‚Çç‚ÇÇ‚Çé ‚â§ ... ‚â§ P&L‚Çç‚Çô‚Çé
4. VaR‚Çê = P&L‚Çç‚åäŒ±n‚åã‚Çé

**2. Parametric Method (Variance-Covariance)**:
Assume normal distribution: P&L ~ N(Œº, œÉ¬≤)
```
VaR‚Çê = Œº + œÉŒ¶‚Åª¬π(Œ±)
```

For portfolios: œÉ¬≤ = w·µÄŒ£w, where Œ£ is the covariance matrix

**3. Monte Carlo Simulation**:
```
1. Simulate asset price paths: S‚ÇÅ, S‚ÇÇ, ..., S‚Çô
2. Calculate portfolio values: V‚ÇÅ, V‚ÇÇ, ..., V‚Çô
3. Compute P&L: P&L·µ¢ = V·µ¢ - V‚ÇÄ
4. VaR‚Çê = Œ±-th quantile of {P&L‚ÇÅ, ..., P&L‚Çô}
```

### Coherent Risk Measures

A risk measure œÅ is **coherent** if and only if it satisfies:

**1. Monotonicity**: X ‚â§ Y ‚üπ œÅ(X) ‚â• œÅ(Y)

**2. Translation Invariance**: œÅ(X + c) = œÅ(X) - c

**3. Positive Homogeneity**: œÅ(ŒªX) = ŒªœÅ(X) for Œª > 0

**4. Sub-additivity**: œÅ(X + Y) ‚â§ œÅ(X) + œÅ(Y)

**Important Conclusions**:
- VaR **fails** sub-additivity (may penalize diversification)
- CVaR **is coherent** (encourages diversification)

### Backtesting and Validation

**Kupiec Test** (VaR model validation):
```
H‚ÇÄ: Violation rate = Œ±
Test statistic: LR = -2ln[L(pÃÇ)/L(Œ±)]
where pÃÇ = number of violations / number of observations
```

**Stress Testing**:
- Extreme market scenario analysis
- Factor shock tests
- Historical scenario replications

---

## 4. Monte Carlo Methods: Simulating Expectations under a Measure

### Basic Theory

**Law of Large Numbers**:
```
(1/N)Œ£·µ¢‚Çå‚ÇÅ·¥∫ f(X·µ¢) ‚Üí E[f(X)] as N ‚Üí ‚àû
```

**Central Limit Theorem**:
```
‚àöN[(1/N)Œ£f(X·µ¢) - E[f(X)]] ‚Üí N(0, Var[f(X)])
```

**Convergence Rate**: O(1/‚àöN) - independent of dimension

**From a Measure Perspective**:
Monte Carlo essentially approximates the theoretical measure with the empirical measure:
```
Œº‚Çô = (1/N)Œ£·µ¢‚Çå‚ÇÅ·¥∫ Œ¥_X·µ¢ ‚Üí Œº (weak convergence)
```

### Path Generation Methods

**1. Euler-Maruyama Scheme**:
For SDE: dX = Œº(X,t)dt + œÉ(X,t)dW
```
X‚Çú‚ÇäŒî‚Çú = X‚Çú + Œº(X‚Çú,t)Œît + œÉ(X‚Çú,t)‚àöŒît Z
```

**2. Milstein Scheme** (higher order):
```
X‚Çú‚ÇäŒî‚Çú = X‚Çú + ŒºŒît + œÉ‚àöŒît Z + (1/2)œÉœÉ'Œît(Z¬≤ - 1)
```

**3. Exact Simulation** (when available):
For geometric Brownian motion:
```
S(T) = S‚ÇÄ exp((r - œÉ¬≤/2)T + œÉ‚àöT Z)
```

### Variance Reduction Techniques

**1. Antithetic Variates**:
```
Use both Z and -Z in simulation
Estimator: [f(Z) + f(-Z)]/2
Variance reduction when f is monotonic
```

**2. Control Variates**:
```
fÃÉ = f(X) - Œ≤[g(X) - E[g(X)]]
Choose Œ≤ to minimize Var[fÃÉ]
Optimal: Œ≤* = Cov[f(X),g(X)]/Var[g(X)]
```

**3. Importance Sampling**:
```
E[f(X)] = ‚à´ f(x)p(x)dx = ‚à´ f(x)[p(x)/q(x)]q(x)dx
Estimator: (1/N)Œ£f(Y·µ¢)[p(Y·µ¢)/q(Y·µ¢)] where Y·µ¢ ~ q
```

**Measure Perspective Interpretation**:
- Importance sampling = measure change (from q to p)
- Radon-Nikodym derivative = p(x)/q(x)

**4. Stratified Sampling**:
Divide [0,1] into k strata, sample within each:
```
Estimator: Œ£‚Çñ(n‚Çñ/N)XÃÑ‚Çñ where n‚Çñ = stratum k sample size
```

### Multi-Dimensional Simulation

**Cholesky Decomposition** (for correlated normals):
```
If Œ£ = LL·µÄ (Cholesky decomposition)
Then X = Œº + LZ gives X ~ N(Œº, Œ£)
```

**Principal Component Analysis**:
```
Œ£ = QŒõQ·µÄ (eigendecomposition)
Generate Y ~ N(0, Œõ), set X = Œº + QY
```

### Quasi-Monte Carlo

**Low-Discrepancy Sequences**:
- Sobol sequences
- Halton sequences
- Latin hypercube sampling

**Convergence Rate**: O((log N)·µà/N) where d = dimension

Better than standard MC for smooth integrands in moderate dimensions.

---

## 5. PDE Numerical Methods: Directly Solving the Value Function

### Finite Difference Methods

**Grid Setup**:
```
Space: S ‚àà [0, S‚Çò‚Çê‚Çì] with ŒîS = S‚Çò‚Çê‚Çì/M
Time: t ‚àà [0, T] with Œît = T/N
Grid points: (iŒîS, jŒît) for i = 0,...,M; j = 0,...,N
```

**Discrete Operators**:
```
‚àÇV/‚àÇS ‚âà (V·µ¢‚Çä‚ÇÅ ≤ - V·µ¢‚Çã‚ÇÅ ≤)/(2ŒîS)  (central difference)
‚àÇ¬≤V/‚àÇS¬≤ ‚âà (V·µ¢‚Çä‚ÇÅ ≤ - 2V·µ¢ ≤ + V·µ¢‚Çã‚ÇÅ ≤)/(ŒîS)¬≤  (second difference)
‚àÇV/‚àÇt ‚âà (V·µ¢ ≤‚Å∫¬π - V·µ¢ ≤)/Œît  (forward difference)
```

**Explicit Scheme** (Forward Euler):
```
V·µ¢ ≤‚Å∫¬π = V·µ¢ ≤ + Œît[¬ΩœÉ¬≤i¬≤ŒîS¬≤(V·µ¢‚Çä‚ÇÅ ≤ - 2V·µ¢ ≤ + V·µ¢‚Çã‚ÇÅ ≤)/(ŒîS)¬≤ +
         riŒîS(V·µ¢‚Çä‚ÇÅ ≤ - V·µ¢‚Çã‚ÇÅ ≤)/(2ŒîS) - rV·µ¢ ≤]
```

Stability condition: Œît ‚â§ (ŒîS)¬≤/(œÉ¬≤S‚Çú‚Çí‚Çö¬≤)

**Implicit Scheme** (Backward Euler):
```
V·µ¢ ≤ = V·µ¢ ≤‚Å∫¬π + Œît[‚ÑíV·µ¢ ≤‚Å∫¬π]
```
Requires solving a tridiagonal system, but unconditionally stable.

**Crank-Nicolson Scheme**:
```
V·µ¢ ≤‚Å∫¬π - V·µ¢ ≤ = (Œît/2)[‚ÑíV·µ¢ ≤ + ‚ÑíV·µ¢ ≤‚Å∫¬π]
```
Second-order accurate in time, unconditionally stable.

### Boundary Conditions

**Far-field Boundaries**:
- S ‚Üí 0: V ‚âà discounted intrinsic value
- S ‚Üí ‚àû: V ‚âà S - Ke^(-r(T-t)) (call); V ‚âà 0 (put)

**Free Boundary Problems** (American options):
Use penalty methods or linear complementarity formulation.

---

## 6. Model Calibration and Parameter Estimation

### Maximum Likelihood Estimation

**Log-Likelihood for Geometric Brownian Motion**:
Given observations S‚ÇÄ, S‚ÇÅ, ..., S‚Çô at times 0, Œît, 2Œît, ..., nŒît

```
‚Ñì(Œº, œÉ) = -¬Ωn ln(2œÄœÉ¬≤Œît) - (1/(2œÉ¬≤Œît))Œ£·µ¢‚Çå‚ÇÅ‚Åø[ln(S·µ¢/S·µ¢‚Çã‚ÇÅ) - (Œº - œÉ¬≤/2)Œît]¬≤
```

**MLE Solutions**:
```
ŒºÃÇ = (1/(nŒît))ln(S‚Çô/S‚ÇÄ) + œÉÃÇ¬≤/2
œÉÃÇ¬≤ = (1/(nŒît))Œ£·µ¢‚Çå‚ÇÅ‚Åø[ln(S·µ¢/S·µ¢‚Çã‚ÇÅ) - ŒºÃÇŒît + œÉÃÇ¬≤Œît/2]¬≤
```

### Method of Moments

Match sample moments to theoretical moments:
```
Sample mean = Theoretical mean
Sample variance = Theoretical variance
...
```

For GBM with observations r·µ¢ = ln(S·µ¢/S·µ¢‚Çã‚ÇÅ):
```
ŒºÃÇ = rÃÑ/Œît + œÉÃÇ¬≤/2
œÉÃÇ¬≤ = s¬≤·µ£/Œît
```

### Implied Parameter Calibration

**Objective Function**:
```
min Œ£·µ¢ w·µ¢[V_model(K·µ¢, T·µ¢; Œ∏) - V_market(K·µ¢, T·µ¢)]¬≤
```

Common weights: w·µ¢ = 1/V_market(K·µ¢, T·µ¢) (relative error)

**Optimization Challenges**:
- Non-convex objective function
- Multiple local minima
- Parameter constraints
- Ill-conditioning near parameter boundaries

**Regularization Techniques**:
```
Objective = Fit Error + Œª √ó Penalty(Œ∏)
```
Where Penalty(Œ∏) prevents extreme parameter values.

### Implied Volatility Surface

**Smile/Skew Phenomena**:
- At-the-money: Benchmark volatility
- Out-of-the-money puts: Higher implied vol (crash premium)
- Out-of-the-money calls: Varying patterns across markets

**Parametric Models**:

1. **SVI (Stochastic Volatility Inspired)**:
   ```
   œÉ¬≤·µ¢·µ•(k) = a + b[œÅ(k-m) + ‚àö((k-m)¬≤ + œÉ¬≤)]
   ```

2. **SABR Model**:
   ```
   œÉ·µ¢·µ•(K,T) ‚âà (Œ±/fÃÉ^(1-Œ≤))[1 + ((1-Œ≤)¬≤Œ±¬≤)/(24fÃÉ^(2-2Œ≤))T + ...]
   ```

**Arbitrage-Free Conditions**:
- Calendar arbitrage: ‚àÇœÉ·µ¢·µ•/‚àÇT ‚â• constraints
- Butterfly arbitrage: ‚àÇ¬≤C/‚àÇK¬≤ ‚â• 0

---

## Implementation Best Practices

### Code Structure
1. **Modular Design**: Separate mathematical components
2. **Parameter Validation**: Check bounds and conditions
3. **Numerical Stability**: Handle edge cases gracefully
4. **Performance Optimization**: Vectorization, caching
5. **Testing**: Unit tests for each mathematical component

### Common Pitfalls
1. **Numerical Overflow**: Use log-space calculations when possible
2. **PDF Underflow**: Implement robust normal PDF/CDF
3. **Parameter Bounds**: Enforce constraints during optimization
4. **Convergence Criteria**: Set appropriate tolerances
5. **Market Data Quality**: Clean and validate inputs

### Validation Methods
1. **Analytical Benchmarks**: Compare to known solutions
2. **Convergence Testing**: Verify O(h¬≤) or O(1/‚àöN) rates
3. **Cross-Validation**: Out-of-sample testing
4. **Stress Testing**: Extreme parameter regimes
5. **Market Comparison**: Validate against observed prices

---

## Summary: Unified Measure-PDE-Pricing Framework

This document presents a unified perspective on derivative pricing:

1. **Starting Point**: Randomness of market prices (stochastic processes)
2. **Core Transformation**: Measure change (P ‚Üí Q) eliminates risk premium
3. **Value Definition**: V = E^Q[discounted Payoff] (risk-neutral pricing)
4. **Dynamic Evolution**: Characterized by PDEs or expectation equations
5. **Numerical Solution**: FDM, MC, Fourier methods, etc.
6. **Practical Calibration**: Back out model parameters from market data

All pricing models (Black-Scholes, Heston, Local Vol, etc.) follow this logical chain; they differ only in their specific assumptions about price dynamics.
